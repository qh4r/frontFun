define(function(){function t(t,e){this.db=e;var i=document.createElement("div");i.className="note",i.addEventListener("mousedown",function(t){return this.onMouseDown(t)}.bind(this),!1),i.addEventListener("click",function(t){return this.onNoteClick(t)}.bind(this),!1),this.note=i;var n=document.createElement("div");n.className="close-btn",n.addEventListener("click",function(t){return this.close(t)}.bind(this),!1),i.appendChild(n);var s=document.createElement("div");s.className="edit",s.setAttribute("content-editable",""),s.addEventListener("keyup",function(t){return this.onKeyUp(t)}.bind(this),!1),i.appendChild(s),this.editField=s;var o=document.createElement("div");return o.className="timestamp",o.addEventListener("mousedown",function(t){return this.onMouseDown(t)}.bind(this),!1),i.appendChild(o),this.lastModified=o,this.container=t||document.body,this.container.appendChild(this.note),this}function e(t){return this!=n?!0:(this.left=t.clientX-this.startX+"px",this.top=t.clientY-this.startY+"px",!1)}function i(){return document.removeEventListener("mousemove",this.mouseMoveHandler,!0),document.removeEventListener("mouseup",this.mouseUpHandler,!0),this.save(),!1}var n=null,s=0;return t.prototype={get container(){if(!1 in this)throw new Error("no container object");return this._container},set container(t){this._container=t},get db(){if(!1 in this)throw new Error("no db object");return this._db},set db(t){this._db=t},get id(){return"_id"in this||(this._id=0),this._id},set id(t){this._id=t},get text(){return this.editField.innerHTML},set text(t){this.editField.innerHTML=t},get timestamp(){return"_timestamp"in this||(this._timestamp=0),this._timestamp},set timestamp(t){if(this._timestamp!==t){this._timestamp=t;var e=new Date(Number(t));this.lastModified.textContent=e}},get left(){return this.note.style.left},set left(t){this.note.style.left=t},get top(){return this.note.style.top},set top(t){this.note.style.top=t},get zIndex(){return this.note.style.zIndex},set zIndex(t){this.note.style.zIndex=t},onMouseDown:function(t){n=this,this.startX=t.clientX-this.note.offsetLeft,this.startY=t.clientY-this.note.offsetTop,this.zIndex=++s,"mouseMoveHandler"in this||(this.mouseMoveHandler=function(t){return e.call(this,t)}.bind(this),this.mouseUpHandler=function(t){return i.call(this,t)}.bind(this)),document.addEventListener("mousemove",this.mouseMoveHandler,!0),document.addEventListener("mouseup",this.mouseUpHandler,!0)},onNoteClick:function(t){console.log(this.db)},onKeyUp:function(t){},close:function(t){this.cancelPendingSave(),this.db.transaction(function(t){t.executeSql("delete from MyNotes where id = ?",[this.id])}.bind(this)),this.container.removeChild(this.note)},cancelPendingSave:function(){"_saveTimer"in this&&(clearTimeout(this._saveTimer),delete this._saveTimer)},saveSoon:function(){this.cancelPendingSave(),this._saveTimer=setTimeout(function(){this.save()}.bind(this),200)},save:function(){this.cancelPendingSave(),"dirty"in this&&(this.timestamp=(new Date).getTime(),delete this.dirty),this.db.transaction(function(t){t.executeSql("Update MyNotes set note = ?, timestamp = ?, left = ?, top = ?, zindex = ? where id = ?",[this.text,this.timestamp,this.left,this.top,this.zIndex,this.id])}.bind(this))},saveAsNew:function(){this.timestamp=(new Date).getTime(),this.db.transaction(function(t){t.executeSql("insert into MyNotes (id, note, timestamp, left, top, zindex) values(?, ?, ?, ?, ?, ?",[this.id,this.text,this.timestamp,this.left,this.top,this.zIndex])}.bind(this))}},t});